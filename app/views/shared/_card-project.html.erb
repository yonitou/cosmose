<div class="cards">
  <% projects.each do |project| %>
  <div class="card">
    <%= link_to project_path(project) do %>
     <% project_images = project.blocks.map{|image|image if !image.content.include?('youtube') && image.upload.attached? && image.upload.image?}%>
          <% if project_images.reject{|project_image| project_image.nil?}.length >= 1%>
          <div class="card-images d-flex flex-column justify-content-between" style="background-image:url(<%= rails_blob_url(project_images.first.upload)%>)">
          <% else %>
          <div class="card-images d-flex flex-column justify-content-between" style="background-image:url('https://res.cloudinary.com/devlnkl7u/image/upload/v1592338203/cosmose-fond-darkred_fw7cod.png')">
          <% end %>
      <div class="card-images-element-top">
        </div>
      <div class="card-images-elements-bottom d-flex justify-content-between">
        <%= render 'shared/icons', categories: project.categories  %>
        <% if project.user.photo.attached? %>
        <%= cl_image_tag(project.user.photo.key, class: "avatar", alt: "avatar") %>
      <% else %>
        <%= image_tag 'https://via.placeholder.com/50', class: "avatar"  %>
      <% end %>
      </div>
    </div>
    <div class="card-content">
      <h4 class="card-title"><%= project.title %></h4>
      <p><%= project.description %></p>
      <p class="card-localisation">
        <% if project.latitude %>
          <%= Geocoder.search([project.latitude, project.longitude]).first.county %>
        <% else %>
          <%= project.address.first(20) %>...
        <% end %>
      </p>
    </div>
    <% end %>
  </div>
  <% end %>
</div>
